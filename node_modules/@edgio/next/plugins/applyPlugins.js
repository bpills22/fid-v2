"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const withEdgioConfig_1 = require("./withEdgioConfig");
const withImageDomainsConfig_1 = require("./withImageDomainsConfig");
const withImageLoaderConfig_1 = require("./withImageLoaderConfig");
/**
 * Creates a Next.js config suitable for deployment on Edgio
 * by applying all plugins for next-config
 *
 * Example usage:
 *
 * ```js
 *  // next.config.js
 *
 *  import withEdgio from '@edgio/next/withEdgio'
 *
 *  module.exports = withEdgio({
 *    webpack(config, options) {
 *      // your custom webpack config here
 *    }
 *  })
 * ```
 *
 * @param _nextConfig A next.js config
 * @return A next.js config
 */
function applyPlugins(_nextConfig) {
    const normalizedNextConfig = typeof _nextConfig === 'function' ? _nextConfig : () => _nextConfig || {};
    const plugin = (...args) => {
        // validateNextConfig looks for this to ensure that the configuration is valid
        process.env.WITH_EDGIO_APPLIED = 'true';
        const nextConfig = normalizedNextConfig(...args);
        const plugins = [withEdgioConfig_1.withEdgioConfig, withImageLoaderConfig_1.withImageLoaderConfig, withImageDomainsConfig_1.withImageDomainsConfig];
        return plugins.reduce((appliedConfig, plugin) => plugin(appliedConfig), nextConfig);
    };
    return typeof _nextConfig === 'function' ? plugin : plugin();
}
exports.default = applyPlugins;
